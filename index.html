<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Attendance</title>
    <style>
        body {
            background-color: #121212;
            color: #ffffff;
            font-family: Arial, sans-serif;
            text-align: center;
        }
        .container {
            max-width: 600px;
            margin: auto;
            padding: 20px;
        }
        input, select, button {
            padding: 10px;
            margin: 10px;
            font-size: 16px;
        }
        .result {
            margin-top: 20px;
            padding: 10px;
            background-color: #1e1e1e;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Employee Attendance</h1>
        <input type="text" id="employeeName" placeholder="Enter Employee Name">
        <select id="month">
            <option value="2">February</option>
            <option value="3">March</option>
            <option value="4">April</option>
        </select>
        <button onclick="fetchAttendance()">Check Attendance</button>
        <div id="output" class="result"></div>
    </div>

    <script>
        const SHEET_ID = "1xydLswJHJPS6Vry7P7XcjUMdTRJK1vQ-VatN4B4chLI";
        const API_KEY = "AIzaSyBIAZIlEL2OqSP4SGvUjcjZwL9p7aPVWuA";

        async function fetchAttendance() {
            const employeeName = document.getElementById("employeeName").value.trim();
            const month = document.getElementById("month").value;
            const outputDiv = document.getElementById("output");
            outputDiv.innerHTML = "Loading...";

            if (!employeeName) {
                outputDiv.innerHTML = "❌ Please enter an employee name.";
                return;
            }

            let attendanceData = [];
            let sheetFound = false;
            let employeeFound = false;

            for (let day = 1; day <= 31; day++) {
                const sheetName = `${day}/${month}`;
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${sheetName}?key=${API_KEY}`;
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        outputDiv.innerHTML = "❌ Error fetching data. Please check API key or Sheet ID.";
                        return;
                    }
                    const data = await response.json();
                    if (!data.values) continue;

                    sheetFound = true;
                    for (let row of data.values) {
                        if (row[3] === employeeName) {
                            employeeFound = true;
                            const status = row[14] || "0";
                            const time = row[15] || "-";
                            const deduction = row[17] || "None";
                            const isLate = (time !== "-" && new Date(`2000-01-01 ${time}`) > new Date("2000-01-01 08:05 AM"));
                            attendanceData.push({ day, status, time, deduction, isLate });
                        }
                    }
                } catch (error) {
                    outputDiv.innerHTML = "❌ Error fetching data. Possible API issue.";
                    return;
                }
            }

            if (!sheetFound) {
                outputDiv.innerHTML = "⚠️ No sheets found for the selected month. Make sure the sheet names follow the format 'day/month'.";
                return;
            }
            if (!employeeFound) {
                outputDiv.innerHTML = "⚠️ No records found for this employee in the selected month.";
                return;
            }
            displayAttendance(attendanceData);
        }

        function displayAttendance(data) {
            const outputDiv = document.getElementById("output");
            let resultHTML = "<h2>Attendance Details</h2>";
            data.forEach(record => {
                resultHTML += `<p>Day ${record.day}: ${record.status !== "0" ? "Present" : "Absent"}`;
                if (record.isLate) resultHTML += " - Late (Half-day Deduction)";
                if (record.deduction !== "None") resultHTML += ` - Deduction: ${record.deduction}`;
                resultHTML += "</p>";
            });
            outputDiv.innerHTML = resultHTML;
        }
    </script>
</body>
</html>
